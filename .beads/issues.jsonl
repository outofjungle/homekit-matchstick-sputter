{"id":"homekit-matchstick-sputter-035","title":"Test runner animations on hardware","description":"Build, flash, and verify on device:\n1. Base layer breathing visible with per-LED hue undulation\n2. Monochromatic Runner shows black/white runners\n3. Complementary Runner uses opposite hue\n4. Brightness changes runner density (1 at low, 4 at high)\n5. Turning off channel blacks it out\n6. Runners don't overlap, spacing varies naturally\n7. Tail blending visible at trailing edge\n8. Base hue undulation stays within ±5° bounds\n9. Button cycles through all animation modes correctly","status":"closed","priority":2,"issue_type":"task","owner":"venkat.venkataraju@gmail.com","created_at":"2026-02-03T20:36:45.812354-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-02-03T20:56:39.897187-08:00","closed_at":"2026-02-03T20:56:39.897187-08:00","close_reason":"Implementation complete and committed","dependencies":[{"issue_id":"homekit-matchstick-sputter-035","depends_on_id":"homekit-matchstick-sputter-5no","type":"blocks","created_at":"2026-02-03T20:36:53.284737-08:00","created_by":"Venkat Venkataraju"}]}
{"id":"homekit-matchstick-sputter-03l","title":"LED Notification Pattern System","description":"Reusable animation framework for first 8 LEDs across all channels. Supports: solid color, sequential flash, custom patterns. Non-blocking (timer-based animation in loop). Stores/restores previous LED state.","status":"open","priority":2,"issue_type":"task","owner":"venkat.venkataraju@gmail.com","created_at":"2026-01-31T20:18:08.403543-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-01-31T20:18:08.403543-08:00"}
{"id":"homekit-matchstick-sputter-0ao","title":"Fix harmony animations ignoring HomeKit brightness changes","description":"HomeKit brightness changes don't affect harmony animation color ratios in real-time.\n\nRoot Cause:\nanimation_manager.h:renderCurrentAnimation() calls setChannelHues() every frame but never calls setChannelBrightnesses(). The brightness ratio logic exists in HarmonyTwinkleBase::assignLedHues() but is never triggered.\n\nAffected Animations:\n- ComplementaryTwinkle\n- SplitComplementaryTwinkle  \n- TriadicTwinkle\n- SquareTwinkle\n\nNot Affected:\n- MonochromaticTwinkle (doesn't use brightness ratio system)\n- FireAnimation (doesn't use brightness ratio system)\n\nFix:\nAdd setChannelBrightnesses() calls in renderCurrentAnimation() for all HarmonyTwinkleBase-derived animations, similar to how setChannelHues() is called.","status":"closed","priority":2,"issue_type":"bug","owner":"venkat.venkataraju@gmail.com","created_at":"2026-02-02T20:53:26.829643-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-02-02T20:55:26.265816-08:00","closed_at":"2026-02-02T20:55:26.265816-08:00","close_reason":"Closed"}
{"id":"homekit-matchstick-sputter-1nk","title":"Brightness=0 channels don't show color at full brightness on power cycle","description":"Channels with brightness set to 0 should display their color at full brightness during power cycle (boot sequence). Currently they remain dark. This affects the visual indication of configured colors during startup.","status":"closed","priority":2,"issue_type":"bug","owner":"venkat.venkataraju@gmail.com","created_at":"2026-01-31T23:22:24.658511-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-02-02T14:32:04.775776-08:00","closed_at":"2026-02-02T14:32:04.775776-08:00","close_reason":"Closed"}
{"id":"homekit-matchstick-sputter-2mp","title":"Implement MonochromaticRunner class","description":"Create src/animation/monochromatic_runner.h:\n- Derive from RunnerAnimationBase\n- Implement getHarmonyOffsets() returning {0}\n- Implement getNumHarmonyHues() returning 1\n- Override pickRunnerColor() to randomly pick black (h=0, s=0, v=0) or white (h=0, s=0, v=255)\n- Implement getName() returning appropriate name","status":"closed","priority":2,"issue_type":"task","owner":"venkat.venkataraju@gmail.com","created_at":"2026-02-03T20:36:29.066025-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-02-03T20:38:30.603199-08:00","closed_at":"2026-02-03T20:38:30.603199-08:00","close_reason":"Closed","dependencies":[{"issue_id":"homekit-matchstick-sputter-2mp","depends_on_id":"homekit-matchstick-sputter-f4x","type":"blocks","created_at":"2026-02-03T20:36:51.067803-08:00","created_by":"Venkat Venkataraju"}]}
{"id":"homekit-matchstick-sputter-2nc","title":"Implement Tetradic Twinkle animation","description":"Create src/animation/tetradic_twinkle.h using HarmonyTwinkleBase. 4 colors rectangle: primary (0°), 60°, 180°, 240°. LED distribution: 20-80% primary, remainder split equally among 3 secondary hues.","status":"open","priority":2,"issue_type":"task","owner":"venkat.venkataraju@gmail.com","created_at":"2026-02-02T20:09:17.06241-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-02-02T20:09:17.06241-08:00","dependencies":[{"issue_id":"homekit-matchstick-sputter-2nc","depends_on_id":"homekit-matchstick-sputter-6to","type":"blocks","created_at":"2026-02-02T20:09:23.377699-08:00","created_by":"Venkat Venkataraju"}]}
{"id":"homekit-matchstick-sputter-2nu","title":"NVS Storage for Channel State","description":"Store HSV color and brightness values in NVS for persistence across power cycles. Fresh devices default to channel-specific hues (0°, 90°, 270°, 180°) with 25% brightness. Channels with brightness=0 flash for 5 seconds at boot with stored color at 25% brightness, then turn off.","status":"closed","priority":2,"issue_type":"feature","owner":"venkat.venkataraju@gmail.com","created_at":"2026-01-31T21:55:46.13064-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-01-31T21:55:52.738996-08:00","closed_at":"2026-01-31T21:55:52.738996-08:00","close_reason":"Implemented NVS storage with channel_storage.h, updated led_channel.h with boot flash logic and default hues, modified main.cpp to track channel instances. Build successful, color/brightness persistence working, boot flash still being tested."}
{"id":"homekit-matchstick-sputter-3bf","title":"Create src/led_channel.h with HomeKit LightBulb service","description":"Create new DEV_LedChannel struct extending Service::LightBulb with power, hue, saturation, brightness characteristics. Implement update() method using FastLED CHSV for HSV→RGB conversion. Each instance controls one LED channel array.","status":"closed","priority":2,"issue_type":"task","owner":"venkat.venkataraju@gmail.com","created_at":"2026-01-30T17:21:15.808888-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-01-31T15:04:11.148871-08:00","closed_at":"2026-01-31T15:04:11.148871-08:00","close_reason":"Closed"}
{"id":"homekit-matchstick-sputter-3gk","title":"Channel colors and brightness not restored after aborted reset","description":"When a reset is aborted (user cancels mid-reset), the channel colors and brightness values do not restore to their previous state. Expected: channels should return to their pre-reset configuration after abort.","status":"closed","priority":2,"issue_type":"bug","owner":"venkat.venkataraju@gmail.com","created_at":"2026-01-31T23:22:24.475905-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-02-02T15:24:04.417018-08:00","closed_at":"2026-02-02T15:24:04.417018-08:00","close_reason":"Fixed by FSM implementation - state transitions now properly handle reset abort scenarios"}
{"id":"homekit-matchstick-sputter-3o3","title":"Factory Reset Logic","description":"Implement long-press button detection (e.g., 5+ seconds) to clear HomeSpan NVS storage (WiFi + pairing data). Provide visual feedback during reset using LED pattern and auto-reboot after reset.","status":"in_progress","priority":2,"issue_type":"feature","owner":"venkat.venkataraju@gmail.com","created_at":"2026-01-31T19:31:54.720969-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-01-31T20:05:15.913295-08:00","dependencies":[{"issue_id":"homekit-matchstick-sputter-3o3","depends_on_id":"homekit-matchstick-sputter-9cf","type":"blocks","created_at":"2026-01-31T20:05:21.113482-08:00","created_by":"Venkat Venkataraju"}]}
{"id":"homekit-matchstick-sputter-42r","title":"Implement TriadicRunner class","description":"Create src/animation/triadic_runner.h:\n- Derive from RunnerAnimationBase\n- Implement getHarmonyOffsets() returning {0, 120, 240}\n- Implement getNumHarmonyHues() returning 3\n- Implement getName() returning appropriate name","status":"closed","priority":2,"issue_type":"task","owner":"venkat.venkataraju@gmail.com","created_at":"2026-02-03T20:36:32.06417-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-02-03T20:38:30.670212-08:00","closed_at":"2026-02-03T20:38:30.670212-08:00","close_reason":"Closed","dependencies":[{"issue_id":"homekit-matchstick-sputter-42r","depends_on_id":"homekit-matchstick-sputter-f4x","type":"blocks","created_at":"2026-02-03T20:36:51.36916-08:00","created_by":"Venkat Venkataraju"}]}
{"id":"homekit-matchstick-sputter-4vz","title":"Display Mode Cycle","description":"Short press handler that cycles through display modes. Initial implementation can be a placeholder that prints to serial. Can be expanded later with actual display modes.","status":"open","priority":2,"issue_type":"task","owner":"venkat.venkataraju@gmail.com","created_at":"2026-01-31T20:04:58.326382-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-01-31T20:04:58.326382-08:00"}
{"id":"homekit-matchstick-sputter-5no","title":"Integrate runner animations into AnimationManager","description":"Update src/animation/animation_manager.h:\n- Add 5 new AnimationMode enum values after ANIM_SQUARE: ANIM_MONOCHROMATIC_RUNNER, ANIM_COMPLEMENTARY_RUNNER, ANIM_SPLIT_COMPLEMENTARY_RUNNER, ANIM_TRIADIC_RUNNER, ANIM_SQUARE_RUNNER\n- Add 5 animation instance members\n- Add includes for all 5 runner animation headers\n- Add switch cases in update(), renderCurrentAnimation(), getModeName()\n- Update button cycle order: HomeKit → Fire → Twinkle variants → Runner variants → HomeKit","status":"closed","priority":2,"issue_type":"task","owner":"venkat.venkataraju@gmail.com","created_at":"2026-02-03T20:36:41.006541-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-02-03T20:39:41.039558-08:00","closed_at":"2026-02-03T20:39:41.039558-08:00","close_reason":"Closed","dependencies":[{"issue_id":"homekit-matchstick-sputter-5no","depends_on_id":"homekit-matchstick-sputter-2mp","type":"blocks","created_at":"2026-02-03T20:36:52.69542-08:00","created_by":"Venkat Venkataraju"},{"issue_id":"homekit-matchstick-sputter-5no","depends_on_id":"homekit-matchstick-sputter-9wu","type":"blocks","created_at":"2026-02-03T20:36:52.792714-08:00","created_by":"Venkat Venkataraju"},{"issue_id":"homekit-matchstick-sputter-5no","depends_on_id":"homekit-matchstick-sputter-9rw","type":"blocks","created_at":"2026-02-03T20:36:52.890211-08:00","created_by":"Venkat Venkataraju"},{"issue_id":"homekit-matchstick-sputter-5no","depends_on_id":"homekit-matchstick-sputter-42r","type":"blocks","created_at":"2026-02-03T20:36:53.017-08:00","created_by":"Venkat Venkataraju"},{"issue_id":"homekit-matchstick-sputter-5no","depends_on_id":"homekit-matchstick-sputter-gug","type":"blocks","created_at":"2026-02-03T20:36:53.11775-08:00","created_by":"Venkat Venkataraju"}]}
{"id":"homekit-matchstick-sputter-5qx","title":"Create docs/HOMESPAN.md with setup and pairing guide","description":"Create comprehensive documentation covering: WiFi configuration via Serial CLI (press W), HomeKit pairing steps with QR code, troubleshooting common issues, serial commands reference, expected behavior for all 4 channels","status":"closed","priority":3,"issue_type":"task","owner":"venkat.venkataraju@gmail.com","created_at":"2026-01-30T17:21:16.233982-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-01-31T15:05:37.95939-08:00","closed_at":"2026-01-31T15:05:37.95939-08:00","close_reason":"Closed"}
{"id":"homekit-matchstick-sputter-61k","title":"Captive Portal AP for WiFi Setup","description":"Replace hard-coded WiFi credentials with captive portal. Enable AP mode when no credentials stored, provide web interface for SSID/password entry, save credentials to NVS and reboot. **Cleanup**: Delete wifi_credentials.h and remove from .gitignore","status":"open","priority":2,"issue_type":"feature","owner":"venkat.venkataraju@gmail.com","created_at":"2026-01-31T19:31:55.32304-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-01-31T19:31:55.32304-08:00","dependencies":[{"issue_id":"homekit-matchstick-sputter-61k","depends_on_id":"homekit-matchstick-sputter-3o3","type":"blocks","created_at":"2026-01-31T19:32:02.109784-08:00","created_by":"Venkat Venkataraju"}]}
{"id":"homekit-matchstick-sputter-6to","title":"Implement HarmonyTwinkleBase shared base class","description":"Create src/animation/harmony_twinkle_base.h with shared harmony logic: LED distribution by brightness, analogous spread (ANGLE_WIDTH), Fisher-Yates shuffle. Foundation for all multi-hue harmony animations.","status":"open","priority":1,"issue_type":"task","owner":"venkat.venkataraju@gmail.com","created_at":"2026-02-02T20:09:10.078883-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-02-02T20:09:10.078883-08:00"}
{"id":"homekit-matchstick-sputter-75p","title":"Hello World Sputter Lights","description":"Phase 2: HomeKit Integration - Add HomeSpan bridge with 4 independent HomeKit light accessories controllable via Apple Home app. Each LED channel (GPIO 26/18/25/19) becomes a fully-featured LightBulb accessory with HSV color control.","status":"closed","priority":2,"issue_type":"feature","owner":"venkat.venkataraju@gmail.com","created_at":"2026-01-30T17:24:24.350969-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-01-31T15:05:37.984061-08:00","closed_at":"2026-01-31T15:05:37.984061-08:00","close_reason":"Closed","dependencies":[{"issue_id":"homekit-matchstick-sputter-75p","depends_on_id":"homekit-matchstick-sputter-oxh","type":"blocks","created_at":"2026-01-30T17:24:31.792198-08:00","created_by":"Venkat Venkataraju"},{"issue_id":"homekit-matchstick-sputter-75p","depends_on_id":"homekit-matchstick-sputter-crq","type":"blocks","created_at":"2026-01-30T17:24:32.010402-08:00","created_by":"Venkat Venkataraju"},{"issue_id":"homekit-matchstick-sputter-75p","depends_on_id":"homekit-matchstick-sputter-3bf","type":"blocks","created_at":"2026-01-30T17:24:32.227984-08:00","created_by":"Venkat Venkataraju"},{"issue_id":"homekit-matchstick-sputter-75p","depends_on_id":"homekit-matchstick-sputter-cm1","type":"blocks","created_at":"2026-01-30T17:24:32.450869-08:00","created_by":"Venkat Venkataraju"},{"issue_id":"homekit-matchstick-sputter-75p","depends_on_id":"homekit-matchstick-sputter-5qx","type":"blocks","created_at":"2026-01-30T17:24:32.670337-08:00","created_by":"Venkat Venkataraju"}]}
{"id":"homekit-matchstick-sputter-7bo","title":"Runtime animation parameter adjustment system","description":"Add system to adjust animation parameters at runtime without recompiling. Should support all tunable parameters across all animation types (runner speeds, lengths, colors, twinkle rates, etc.).","status":"open","priority":2,"issue_type":"feature","owner":"venkat.venkataraju@gmail.com","created_at":"2026-02-04T08:43:36.698289-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-02-04T08:43:36.698289-08:00"}
{"id":"homekit-matchstick-sputter-7l0","title":"Phase 0: Delete fire.h and update docs","description":"Delete dead code and update documentation to reflect current state.\n\n## Tasks\n\n### 0a: Delete fire.h\n- File: src/animation/fire.h\n- Reason: Not included by animation_manager.h, no enum value (ANIM_FIRE doesn't exist), not instantiated anywhere\n- Verify with grep: 'FireAnimation', 'fire.h', 'ANIM_FIRE' should have zero matches\n\n### 0b: Update AGENTS.md\n- Remove 'Fire' from 'HomeKit → Fire → Twinkle → HomeKit' cycle\n- Replace with current cycle: 'HomeKit → Runner variants → Rain variants → Twinkle variants → HomeKit'\n- Update animation descriptions to list Runner, Rain, Twinkle families\n\n### 0c: Update docs/COLOR_HARMONIES.md\n- Remove 'FireAnimation (standalone)' from class hierarchy\n- Update hierarchy to show current structure\n- Note: Full hierarchy update happens after Phase 2 when MarkovBaseLayer is added\n\n## Verification\n- make build must succeed\n- grep -r 'fire' src/animation/ should return nothing","status":"open","priority":1,"issue_type":"task","owner":"venkat.venkataraju@gmail.com","created_at":"2026-02-06T07:25:20.572496-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-02-06T07:25:20.572496-08:00","dependencies":[{"issue_id":"homekit-matchstick-sputter-7l0","depends_on_id":"homekit-matchstick-sputter-d6u","type":"blocks","created_at":"2026-02-06T07:26:49.434908-08:00","created_by":"Venkat Venkataraju"}]}
{"id":"homekit-matchstick-sputter-7z1","title":"Implement Split-Complementary Twinkle animation","description":"Create src/animation/split_complementary_twinkle.h using HarmonyTwinkleBase. 3 colors: primary (0°), 150°, 210°. LED distribution: 20-80% primary, remainder split equally.","status":"open","priority":2,"issue_type":"task","owner":"venkat.venkataraju@gmail.com","created_at":"2026-02-02T20:09:14.537099-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-02-02T20:09:14.537099-08:00","dependencies":[{"issue_id":"homekit-matchstick-sputter-7z1","depends_on_id":"homekit-matchstick-sputter-6to","type":"blocks","created_at":"2026-02-02T20:09:23.158365-08:00","created_by":"Venkat Venkataraju"}]}
{"id":"homekit-matchstick-sputter-8bt","title":"Implement Complementary Twinkle animation","description":"Create src/animation/complementary_twinkle.h using HarmonyTwinkleBase. 2 colors: primary (0°) + complement (180°). LED distribution: 20-80% primary based on brightness.","status":"open","priority":2,"issue_type":"task","owner":"venkat.venkataraju@gmail.com","created_at":"2026-02-02T20:09:13.138855-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-02-02T20:09:13.138855-08:00","dependencies":[{"issue_id":"homekit-matchstick-sputter-8bt","depends_on_id":"homekit-matchstick-sputter-6to","type":"blocks","created_at":"2026-02-02T20:09:23.038495-08:00","created_by":"Venkat Venkataraju"}]}
{"id":"homekit-matchstick-sputter-9b6","title":"Factory Reset Logic","description":"Button state machine: IDLE -\u003e PRESSED -\u003e NOTIFICATION -\u003e RESET/CANCELLED. Timing logic for 5s threshold. Integrates with LED Notification Pattern System. Calls homeSpan.processSerialCommand('F') on reset. Implements corrected behavior: 3x animation cycles (not time-limited), cancel on release during sequence or red confirmation.","notes":"WIP commit created. Factory reset logic implemented with 3x animation cycles, but has bugs in cycle detection and state transitions. Status LED added to GPIO22.","status":"in_progress","priority":2,"issue_type":"task","owner":"venkat.venkataraju@gmail.com","created_at":"2026-01-31T20:18:20.191952-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-01-31T21:04:52.57705-08:00","dependencies":[{"issue_id":"homekit-matchstick-sputter-9b6","depends_on_id":"homekit-matchstick-sputter-03l","type":"blocks","created_at":"2026-01-31T20:18:24.127394-08:00","created_by":"Venkat Venkataraju"}]}
{"id":"homekit-matchstick-sputter-9cf","title":"LED Notification Pattern System","description":"Reusable animation framework for first 8 LEDs across all channels. Supports solid color, sequential flash, and custom patterns. Non-blocking timer-based animation. Stores/restores previous LED state.","status":"in_progress","priority":2,"issue_type":"task","owner":"venkat.venkataraju@gmail.com","created_at":"2026-01-31T20:04:58.111783-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-01-31T20:05:50.718964-08:00"}
{"id":"homekit-matchstick-sputter-9rw","title":"Implement SplitComplementaryRunner class","description":"Create src/animation/split_complementary_runner.h:\n- Derive from RunnerAnimationBase\n- Implement getHarmonyOffsets() returning {0, 150, 210}\n- Implement getNumHarmonyHues() returning 3\n- Implement getName() returning appropriate name","status":"closed","priority":2,"issue_type":"task","owner":"venkat.venkataraju@gmail.com","created_at":"2026-02-03T20:36:31.202241-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-02-03T20:38:30.647676-08:00","closed_at":"2026-02-03T20:38:30.647676-08:00","close_reason":"Closed","dependencies":[{"issue_id":"homekit-matchstick-sputter-9rw","depends_on_id":"homekit-matchstick-sputter-f4x","type":"blocks","created_at":"2026-02-03T20:36:51.272669-08:00","created_by":"Venkat Venkataraju"}]}
{"id":"homekit-matchstick-sputter-9wu","title":"Implement ComplementaryRunner class","description":"Create src/animation/complementary_runner.h:\n- Derive from RunnerAnimationBase\n- Implement getHarmonyOffsets() returning {0, 180}\n- Implement getNumHarmonyHues() returning 2\n- Implement getName() returning appropriate name","status":"closed","priority":2,"issue_type":"task","owner":"venkat.venkataraju@gmail.com","created_at":"2026-02-03T20:36:29.803823-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-02-03T20:38:30.625229-08:00","closed_at":"2026-02-03T20:38:30.625229-08:00","close_reason":"Closed","dependencies":[{"issue_id":"homekit-matchstick-sputter-9wu","depends_on_id":"homekit-matchstick-sputter-f4x","type":"blocks","created_at":"2026-02-03T20:36:51.17617-08:00","created_by":"Venkat Venkataraju"}]}
{"id":"homekit-matchstick-sputter-9xa","title":"Ambient Animations (Fire \u0026 Twinkle)","description":"Implement at least 2 ambient animations: Fire simulation effect and Twinkle/sparkle effect. Add button to cycle through animations and integrate with HomeKit (animation as a mode or separate accessory).","status":"in_progress","priority":2,"issue_type":"feature","owner":"venkat.venkataraju@gmail.com","created_at":"2026-01-31T19:31:55.023184-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-02-02T15:35:51.25373-08:00","dependencies":[{"issue_id":"homekit-matchstick-sputter-9xa","depends_on_id":"homekit-matchstick-sputter-stt","type":"blocks","created_at":"2026-01-31T19:32:01.554761-08:00","created_by":"Venkat Venkataraju"}]}
{"id":"homekit-matchstick-sputter-ben","title":"Phase 1: Blink SK6812 status LED on GPIO 27","status":"closed","priority":1,"issue_type":"epic","owner":"venkat.venkataraju@gmail.com","created_at":"2026-01-30T16:27:11.888047-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-01-30T16:33:23.111047-08:00","closed_at":"2026-01-30T16:33:23.111047-08:00","close_reason":"Closed"}
{"id":"homekit-matchstick-sputter-ben.1","title":"Create platformio.ini with FastLED dependency","description":"Create PlatformIO config for ESP32 pico32 board with FastLED@^3.9.15 dependency","status":"closed","priority":1,"issue_type":"task","owner":"venkat.venkataraju@gmail.com","created_at":"2026-01-30T16:27:18.283199-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-01-30T16:28:40.292493-08:00","closed_at":"2026-01-30T16:28:40.292493-08:00","close_reason":"Closed","dependencies":[{"issue_id":"homekit-matchstick-sputter-ben.1","depends_on_id":"homekit-matchstick-sputter-ben","type":"parent-child","created_at":"2026-01-30T16:27:18.284209-08:00","created_by":"Venkat Venkataraju"}]}
{"id":"homekit-matchstick-sputter-ben.2","title":"Create src/config.h with GPIO pin definitions","description":"Define PIN_STATUS_SK6812=27, PIN_STATUS_LED=22, and external channel pins (26,18,25,19) per HARDWARE.md","status":"closed","priority":1,"issue_type":"task","owner":"venkat.venkataraju@gmail.com","created_at":"2026-01-30T16:27:18.505759-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-01-30T16:30:23.457487-08:00","closed_at":"2026-01-30T16:30:23.457487-08:00","close_reason":"Closed","dependencies":[{"issue_id":"homekit-matchstick-sputter-ben.2","depends_on_id":"homekit-matchstick-sputter-ben","type":"parent-child","created_at":"2026-01-30T16:27:18.506745-08:00","created_by":"Venkat Venkataraju"}]}
{"id":"homekit-matchstick-sputter-ben.3","title":"Create src/main.cpp with minimal blink code","description":"Initialize FastLED for SK6812 on GPIO 27, blink red at 500ms interval using millis()","status":"closed","priority":1,"issue_type":"task","owner":"venkat.venkataraju@gmail.com","created_at":"2026-01-30T16:27:18.717784-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-01-30T16:30:34.406364-08:00","closed_at":"2026-01-30T16:30:34.406364-08:00","close_reason":"Closed","dependencies":[{"issue_id":"homekit-matchstick-sputter-ben.3","depends_on_id":"homekit-matchstick-sputter-ben","type":"parent-child","created_at":"2026-01-30T16:27:18.718803-08:00","created_by":"Venkat Venkataraju"}]}
{"id":"homekit-matchstick-sputter-cfz","title":"Additional Ambient Animations","description":"Implement additional ambient effects: Breathing/pulse, Color fade, Candle flicker, Aurora borealis","status":"open","priority":3,"issue_type":"feature","owner":"venkat.venkataraju@gmail.com","created_at":"2026-01-31T19:31:55.679163-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-01-31T19:31:55.679163-08:00","dependencies":[{"issue_id":"homekit-matchstick-sputter-cfz","depends_on_id":"homekit-matchstick-sputter-9xa","type":"blocks","created_at":"2026-01-31T19:32:02.745403-08:00","created_by":"Venkat Venkataraju"}]}
{"id":"homekit-matchstick-sputter-cm1","title":"Rewrite main.cpp for HomeSpan bridge with 4 light accessories","description":"Restructure main.cpp to: initialize HomeSpan bridge, create bridge accessory with device info, add 4 DEV_LedChannel accessories (one per GPIO 26/18/25/19), call homeSpan.poll() in loop, keep FastLED initialization. Remove blink test code.","status":"closed","priority":2,"issue_type":"task","owner":"venkat.venkataraju@gmail.com","created_at":"2026-01-30T17:21:16.017991-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-01-31T15:04:44.87663-08:00","closed_at":"2026-01-31T15:04:44.87663-08:00","close_reason":"Closed","dependencies":[{"issue_id":"homekit-matchstick-sputter-cm1","depends_on_id":"homekit-matchstick-sputter-oxh","type":"blocks","created_at":"2026-01-30T17:21:28.695893-08:00","created_by":"Venkat Venkataraju"},{"issue_id":"homekit-matchstick-sputter-cm1","depends_on_id":"homekit-matchstick-sputter-crq","type":"blocks","created_at":"2026-01-30T17:21:28.991621-08:00","created_by":"Venkat Venkataraju"},{"issue_id":"homekit-matchstick-sputter-cm1","depends_on_id":"homekit-matchstick-sputter-3bf","type":"blocks","created_at":"2026-01-30T17:21:29.291934-08:00","created_by":"Venkat Venkataraju"}]}
{"id":"homekit-matchstick-sputter-crq","title":"Update config.h with HomeSpan configuration","description":"Add HomeSpan device configuration constants to src/config.h: DEVICE_NAME (Sputter Lights), DEVICE_MANUFACTURER (0x76656E Labs), DEVICE_SERIAL (SPT-001), DEVICE_MODEL (4CH-LED), DEVICE_FIRMWARE (1.0.0)","status":"closed","priority":2,"issue_type":"task","owner":"venkat.venkataraju@gmail.com","created_at":"2026-01-30T17:21:15.60177-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-01-31T15:03:48.07113-08:00","closed_at":"2026-01-31T15:03:48.07113-08:00","close_reason":"Closed"}
{"id":"homekit-matchstick-sputter-d5r","title":"Rain animation set (5 harmony variants)","description":"Implement rain animation set with Gaussian blob fade-in-place effect. Includes 5 harmony variants: Monochromatic, Complementary, Split-Complementary, Triadic, and Square. Raindrops spawn at random non-colliding positions and fade over time using time-varying Gaussian variance (0.1 → 10.0). Brightness controls raindrop density (1-6 active drops).","notes":"Implementation completed:\n- docs/RAIN_ANIMATION.md (comprehensive documentation)\n- src/animation/rain/rain_base.h (abstract base class)\n- src/animation/rain/monochromatic_rain.h\n- src/animation/rain/complementary_rain.h\n- src/animation/rain/split_complementary_rain.h\n- src/animation/rain/triadic_rain.h\n- src/animation/rain/square_rain.h\n- Updated docs/COLOR_HARMONIES.md with rain hierarchy\n\nTODO:\n- Integrate into animation_manager.h (add to AnimationMode enum)\n- Add instance members to AnimationManager class\n- Add switch cases for update/start/render/getName\n- Test on hardware","status":"closed","priority":2,"issue_type":"feature","owner":"venkat.venkataraju@gmail.com","created_at":"2026-02-04T18:52:11.003705-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-02-04T18:56:37.363297-08:00","closed_at":"2026-02-04T18:56:37.363297-08:00","close_reason":"Rain animation implementation and integration complete. All 5 harmony variants (Monochromatic, Complementary, Split-Complementary, Triadic, Square) implemented with full animation manager integration. Ready for hardware testing."}
{"id":"homekit-matchstick-sputter-d6u","title":"Animation System Refactoring Epic","description":"Comprehensive refactoring of animation system to eliminate code duplication, establish proper class hierarchy, add polymorphic dispatch in AnimationManager, delete dead code (fire.h), add native tests, and update documentation. See detailed sub-tasks for implementation phases.","status":"open","priority":1,"issue_type":"feature","owner":"venkat.venkataraju@gmail.com","created_at":"2026-02-06T07:25:10.456675-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-02-06T07:25:10.456675-08:00"}
{"id":"homekit-matchstick-sputter-f4x","title":"Implement RunnerAnimationBase class","description":"Create src/animation/runner_base.h with:\n- Base layer: Per-LED random-walk undulations in hue (±ANGLE_WIDTH) and brightness using Markov chain\n- Runner layer: Groups of LEDs traveling from position 0 to end, colored by harmony palette\n- State arrays: hueOffset, hueDir, baseBrightness, brightDir for 4 channels × 200 LEDs\n- Runner struct and spawning logic (1-4 runners based on brightness)\n- Rendering pipeline: compute base color, overlay runners with tail blending\n- Virtual methods: getHarmonyOffsets(), getNumHarmonyHues(), getName()\n- Public API: setChannelHues(), setChannelBrightnesses(), begin(), update(), render(), reset()","status":"closed","priority":2,"issue_type":"task","owner":"venkat.venkataraju@gmail.com","created_at":"2026-02-03T20:36:27.368527-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-02-03T20:38:09.205166-08:00","closed_at":"2026-02-03T20:38:09.205166-08:00","close_reason":"Closed"}
{"id":"homekit-matchstick-sputter-g56","title":"Phase 4: Add native test infrastructure","description":"Set up PlatformIO native test environment with Unity framework for testing pure animation logic on host (not ESP32).\n\n## 4a: Add native test environment to platformio.ini\n\n```ini\n[env:native]\nplatform = native\nbuild_flags =\n    -std=gnu++17\n    -Wall -Wextra -Werror\n    -fno-exceptions -fno-rtti\n    -DNATIVE_TEST\n    -I test/stubs\nbuild_src_filter = -\u003cmain.cpp\u003e\ntest_framework = unity\n```\n\n## 4b: Create test stubs\n\n### test/stubs/Arduino.h\n```cpp\n#pragma once\n#include \u003ccstdint\u003e\n#include \u003ccstdlib\u003e\n\ninline long random(long max) { return std::rand() % max; }\ninline long random(long min, long max) { return min + (std::rand() % (max - min)); }\ninline long map(long x, long in_min, long in_max, long out_min, long out_max) {\n    return (x - in_min) * (out_max - out_min) / (in_max - in_min) + out_min;\n}\ntemplate\u003ctypename T\u003e T constrain(T x, T low, T high) {\n    return (x \u003c low) ? low : (x \u003e high) ? high : x;\n}\ninline uint8_t qadd8(uint8_t a, uint8_t b) { return (a + b \u003e 255) ? 255 : a + b; }\ninline uint8_t qsub8(uint8_t a, uint8_t b) { return (a \u003e b) ? a - b : 0; }\n```\n\n### test/stubs/FastLED.h\n- CRGB struct with r,g,b members\n- CHSV struct with h,s,v and conversion operator to CRGB\n- blend() function\n- fill_solid() function\n\n## 4c: Create test files\n\n### test/test_native/test_markov.cpp\n- test_markov_transition_returns_valid_values() - all returns in {-1, 0, 1}\n- test_markov_transition_momentum_positive() - positive continues \u003e50%\n- test_markov_transition_momentum_negative()\n- test_markov_transition_neutral_distribution() - roughly equal from 0\n- test_markov_brightness_biased_upward_trend()\n\n### test/test_native/test_generate_spread.cpp\n- test_generate_spread_centered() - average near 0\n- test_generate_spread_bounded() - within [-5, 5]\n\n### test/test_native/test_harmony_offsets.cpp\n- test_monochromatic_offsets() - {0}, count=1\n- test_complementary_offsets() - {0, 180}, count=2\n- test_split_complementary_offsets() - {0, 150, 210}, count=3\n- test_triadic_offsets() - {0, 120, 240}, count=3\n- test_square_offsets() - {0, 90, 180, 270}, count=4\n\n### test/test_native/test_color_picking.cpp\n- test_primary_hue_desaturation() - offsets[idx]==0 gets sat=0\n- test_secondary_hue_full_saturation() - non-primary gets sat=255\n\n### test/test_native/test_brightness_knock.cpp\n- test_brightness_knock_to_zero_occurs() - verify knock happens at MAX\n\n### test/test_native/test_gaussian_blend.cpp\n- test_gaussian_peak_at_center() - table[15] == 255\n- test_gaussian_edges_near_zero() - table[0], table[29] \u003c 10\n- test_gaussian_symmetric() - table[i] == table[29-i]\n\n## Verification\n- pio test -e native must pass all tests\n- Tests must respect -fno-rtti -fno-exceptions constraints","status":"open","priority":2,"issue_type":"task","owner":"venkat.venkataraju@gmail.com","created_at":"2026-02-06T07:26:30.340545-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-02-06T07:26:30.340545-08:00","dependencies":[{"issue_id":"homekit-matchstick-sputter-g56","depends_on_id":"homekit-matchstick-sputter-d6u","type":"blocks","created_at":"2026-02-06T07:26:50.02128-08:00","created_by":"Venkat Venkataraju"}]}
{"id":"homekit-matchstick-sputter-goe","title":"Implement Square Twinkle animation","description":"Create src/animation/square_twinkle.h using HarmonyTwinkleBase. 4 colors evenly spaced: primary (0°), 90°, 180°, 270°. LED distribution: 20-80% primary, remainder split equally among 3 secondary hues.","status":"open","priority":2,"issue_type":"task","owner":"venkat.venkataraju@gmail.com","created_at":"2026-02-02T20:09:18.143272-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-02-02T20:09:18.143272-08:00","dependencies":[{"issue_id":"homekit-matchstick-sputter-goe","depends_on_id":"homekit-matchstick-sputter-6to","type":"blocks","created_at":"2026-02-02T20:09:23.488638-08:00","created_by":"Venkat Venkataraju"}]}
{"id":"homekit-matchstick-sputter-gug","title":"Implement SquareRunner class","description":"Create src/animation/square_runner.h:\n- Derive from RunnerAnimationBase\n- Implement getHarmonyOffsets() returning {0, 90, 180, 270}\n- Implement getNumHarmonyHues() returning 4\n- Implement getName() returning appropriate name","status":"closed","priority":2,"issue_type":"task","owner":"venkat.venkataraju@gmail.com","created_at":"2026-02-03T20:36:33.185963-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-02-03T20:38:30.691408-08:00","closed_at":"2026-02-03T20:38:30.691408-08:00","close_reason":"Closed","dependencies":[{"issue_id":"homekit-matchstick-sputter-gug","depends_on_id":"homekit-matchstick-sputter-f4x","type":"blocks","created_at":"2026-02-03T20:36:51.470833-08:00","created_by":"Venkat Venkataraju"}]}
{"id":"homekit-matchstick-sputter-lm7","title":"Phase 1: Lift common state/methods into AnimationBase","description":"Move shared interface members up to AnimationBase and remove shadowed/duplicated declarations from derived classes.\n\n## 1a: Enhance AnimationBase (src/animation/animation_base.h)\n\nAdd to protected section:\n```cpp\n// Constants shared by all animations\nstatic constexpr uint16_t MAX_LEDS = 200;\nstatic constexpr unsigned long FRAME_MS = 50;  // 20fps\nstatic constexpr int ANGLE_WIDTH = 10;         // ±5° hue spread\n\n// Channel state (set by AnimationManager)\nint channelHue[4] = {0, 90, 180, 270};\nint cachedBrightness[4] = {100, 100, 100, 100};\n\n// Frame timing\nunsigned long frameAccumulator = 0;\n```\n\nAdd to public section (virtual methods):\n```cpp\nvirtual void setChannelHues(int h1, int h2, int h3, int h4) {\n    channelHue[0] = h1; channelHue[1] = h2;\n    channelHue[2] = h3; channelHue[3] = h4;\n}\n\nvirtual void setChannelBrightnesses(int b1, int b2, int b3, int b4) {\n    cachedBrightness[0] = b1; cachedBrightness[1] = b2;\n    cachedBrightness[2] = b3; cachedBrightness[3] = b4;\n}\n```\n\nMove generateSpread() from 4 files into AnimationBase protected section.\nMove markovTransition() (60/20/20 momentum) into AnimationBase protected section.\n\n## 1b: Remove duplicates from derived classes\n\n### runner_base.h\n- Remove: MAX_LEDS, FRAME_MS, ANGLE_WIDTH constants\n- Remove: channelHue[4] (line 137) - eliminates shadow\n- Remove: cachedBrightness[4] (line 138)\n- Remove: frameAccumulator (line 141)\n- Remove: setChannelHues() method\n- Remove: setChannelBrightnesses() method\n- Remove: generateSpread() method\n- Remove: markovTransition() method\n- KEEP: BASE_BRIGHTNESS=40, MAX_BRIGHTNESS=220 (rename to MARKOV_BASE_BRIGHTNESS, MARKOV_MAX_BRIGHTNESS for clarity)\n\n### rain_base.h\n- Same removals as runner_base.h\n- Same renaming of brightness constants\n\n### harmony_twinkle_base.h\n- Remove: MAX_LEDS, FRAME_MS, ANGLE_WIDTH\n- Remove: cachedBrightness[4], frameAccumulator\n- Remove: generateSpread()\n- Override setChannelHues() to call base then reassignLedHues()\n- Override setChannelBrightnesses() to call base then check for changes\n\n### monochromatic_twinkle.h\n- Remove: MAX_LEDS, FRAME_MS, ANGLE_WIDTH\n- Remove: frameAccumulator\n- Remove: generateSpread()\n- Remove: setChannelHues() - inherit from base\n- KEEP: TWINKLE_DENSITY=8, FADE_SPEED=15, BASE_BRIGHTNESS=20, MAX_BRIGHTNESS=255 (different from HarmonyTwinkle)\n\n## Verification\n- make build must succeed\n- All 15 animation modes must work identically (no behavioral change)","status":"open","priority":1,"issue_type":"task","owner":"venkat.venkataraju@gmail.com","created_at":"2026-02-06T07:25:38.466418-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-02-06T07:25:38.466418-08:00","dependencies":[{"issue_id":"homekit-matchstick-sputter-lm7","depends_on_id":"homekit-matchstick-sputter-d6u","type":"blocks","created_at":"2026-02-06T07:26:49.596927-08:00","created_by":"Venkat Venkataraju"},{"issue_id":"homekit-matchstick-sputter-lm7","depends_on_id":"homekit-matchstick-sputter-7l0","type":"blocks","created_at":"2026-02-06T07:26:53.905736-08:00","created_by":"Venkat Venkataraju"}]}
{"id":"homekit-matchstick-sputter-m8a","title":"Implement Triadic Twinkle animation","description":"Create src/animation/triadic_twinkle.h using HarmonyTwinkleBase. 3 colors evenly spaced: primary (0°), 120°, 240°. LED distribution: 20-80% primary, remainder split equally.","status":"open","priority":2,"issue_type":"task","owner":"venkat.venkataraju@gmail.com","created_at":"2026-02-02T20:09:15.896068-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-02-02T20:09:15.896068-08:00","dependencies":[{"issue_id":"homekit-matchstick-sputter-m8a","depends_on_id":"homekit-matchstick-sputter-6to","type":"blocks","created_at":"2026-02-02T20:09:23.275082-08:00","created_by":"Venkat Venkataraju"}]}
{"id":"homekit-matchstick-sputter-mjw","title":"Update Monochromatic Twinkle with ANGLE_WIDTH","description":"Update src/animation/twinkle.h: rename to MonochromaticTwinkle, add ANGLE_WIDTH analogous spread, update animation_manager.h references. Maintains backward compatibility for single-hue twinkle effect.","status":"closed","priority":1,"issue_type":"task","owner":"venkat.venkataraju@gmail.com","created_at":"2026-02-02T20:09:11.429597-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-02-04T08:43:34.997487-08:00","closed_at":"2026-02-04T08:43:34.997487-08:00","close_reason":"Closed"}
{"id":"homekit-matchstick-sputter-oxh","title":"Add HomeSpan dependency to platformio.ini","description":"Update platformio.ini to include HomeSpan library (version 2.1.7) in lib_deps alongside FastLED. This is the foundation for HomeKit integration.","status":"closed","priority":2,"issue_type":"task","owner":"venkat.venkataraju@gmail.com","created_at":"2026-01-30T17:21:15.383447-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-01-31T15:03:36.875352-08:00","closed_at":"2026-01-31T15:03:36.875352-08:00","close_reason":"Closed"}
{"id":"homekit-matchstick-sputter-r5y","title":"Phase 3: Polymorphic dispatch in AnimationManager","description":"Replace 4 massive switch statements (~400 lines) with polymorphic dispatch through AnimationBase pointer.\n\n## Current Problem\n\nanimation_manager.h has 4 switch statements covering all 15 modes:\n- update() lines 114-177 (~63 lines)\n- startCurrentAnimation() lines 259-517 (~258 lines)\n- renderCurrentAnimation() first switch lines 551-613 (~62 lines)\n- renderCurrentAnimation() second switch lines 617-680 (~63 lines)\n\nAdding a new animation requires modifying ALL 4 switch statements.\n\n## Solution\n\n### Add lookup table and current pointer\n\n```cpp\nprivate:\n    AnimationBase* animations[ANIM_COUNT];\n    AnimationBase* currentAnimation;\n    // ... keep existing 15 animation instances\n```\n\n### Initialize lookup table in constructor\n\n```cpp\nanimations[ANIM_NONE] = nullptr;\nanimations[ANIM_MONOCHROMATIC_RUNNER] = \u0026monochromaticRunnerAnim;\n// ... map all 15 modes to their instances\n```\n\n### Replace switch statements with polymorphic calls\n\n**update():**\n```cpp\nvoid update() {\n    if (!currentAnimation) return;\n    unsigned long now = millis();\n    unsigned long deltaMs = now - lastUpdateMs;\n    lastUpdateMs = now;\n    if (currentAnimation-\u003eupdate(deltaMs)) {\n        renderCurrentAnimation();\n    }\n}\n```\n\n**startCurrentAnimation():**\n```cpp\nvoid startCurrentAnimation() {\n    // yield channels, save LED state (unchanged)\n    currentAnimation = animations[currentMode];\n    if (!currentAnimation) return;\n    currentAnimation-\u003esetChannelHues(h1, h2, h3, h4);\n    currentAnimation-\u003esetChannelBrightnesses(b1, b2, b3, b4);\n    currentAnimation-\u003ebegin();\n    lastUpdateMs = millis();\n}\n```\n\n**renderCurrentAnimation():**\n```cpp\nvoid renderCurrentAnimation() {\n    if (!currentAnimation) return;\n    currentAnimation-\u003esetChannelHues(h1, h2, h3, h4);\n    currentAnimation-\u003esetChannelBrightnesses(b1, b2, b3, b4);\n    currentAnimation-\u003erender(channel1, channel2, channel3, channel4, numLedsPerChannel);\n    // black out OFF channels (unchanged)\n}\n```\n\n**getModeName():**\n```cpp\nconst char* getModeName(AnimationMode mode) const {\n    if (mode == ANIM_NONE) return \"HomeKit\";\n    if (mode \u003c ANIM_COUNT \u0026\u0026 animations[mode]) return animations[mode]-\u003egetName();\n    return \"Unknown\";\n}\n```\n\n## Lines Eliminated\n~350-400 lines of switch boilerplate reduced to ~50 lines of polymorphic dispatch.\n\n## Verification\n- make build must succeed\n- Test ALL 15 modes cycle correctly on hardware\n- This is highest-risk phase - thorough hardware testing required","status":"open","priority":1,"issue_type":"task","owner":"venkat.venkataraju@gmail.com","created_at":"2026-02-06T07:26:10.2422-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-02-06T07:26:10.2422-08:00","dependencies":[{"issue_id":"homekit-matchstick-sputter-r5y","depends_on_id":"homekit-matchstick-sputter-d6u","type":"blocks","created_at":"2026-02-06T07:26:49.893762-08:00","created_by":"Venkat Venkataraju"},{"issue_id":"homekit-matchstick-sputter-r5y","depends_on_id":"homekit-matchstick-sputter-v7d","type":"blocks","created_at":"2026-02-06T07:26:54.162539-08:00","created_by":"Venkat Venkataraju"}]}
{"id":"homekit-matchstick-sputter-r6b","title":"Phase 5: Final documentation cleanup","description":"Update all documentation to reflect refactored architecture.\n\n## Files to Update\n\n### AGENTS.md\n- Update 'Button Control' section with current animation cycle\n- Update 'Ambient Animations' section to list Runner, Rain, Twinkle families\n- Remove all Fire references\n\n### docs/COLOR_HARMONIES.md\nUpdate class hierarchy to show new structure:\n\n```\nAnimationBase (abstract)\n├── MarkovBaseLayer (abstract - shared base-layer logic)\n│   ├── RunnerAnimationBase (abstract)\n│   │   ├── MonochromaticRunner\n│   │   ├── ComplementaryRunner\n│   │   ├── SplitComplementaryRunner\n│   │   ├── TriadicRunner\n│   │   └── SquareRunner\n│   └── RainAnimationBase (abstract)\n│       ├── MonochromaticRain\n│       ├── ComplementaryRain\n│       ├── SplitComplementaryRain\n│       ├── TriadicRain\n│       └── SquareRain\n├── HarmonyTwinkleBase (abstract)\n│   ├── ComplementaryTwinkle\n│   ├── SplitComplementaryTwinkle\n│   ├── TriadicTwinkle\n│   └── SquareTwinkle\n└── MonochromaticTwinkle (standalone)\n```\n\nUpdate 'Adding New Harmonies' section:\n1. Create new class inheriting from appropriate base\n2. Implement getHarmonyOffsets(), getNumHarmonyHues(), getName()\n3. Add to AnimationMode enum\n4. Add instance member in AnimationManager\n5. Add entry to animations[] lookup table\n6. Done - no switch statements to update!\n\nFix 'Brightness Ratio Not Updating' bug section - note it's now resolved via polymorphic dispatch.\n\n### docs/RAIN_ANIMATION.md\n- Update class hierarchy to show MarkovBaseLayer as parent\n\n## Verification\n- Documentation accurately reflects code structure\n- No references to FireAnimation remain\n- Adding new animation instructions are correct","status":"open","priority":2,"issue_type":"task","owner":"venkat.venkataraju@gmail.com","created_at":"2026-02-06T07:26:44.502903-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-02-06T07:26:44.502903-08:00","dependencies":[{"issue_id":"homekit-matchstick-sputter-r6b","depends_on_id":"homekit-matchstick-sputter-d6u","type":"blocks","created_at":"2026-02-06T07:26:50.144569-08:00","created_by":"Venkat Venkataraju"},{"issue_id":"homekit-matchstick-sputter-r6b","depends_on_id":"homekit-matchstick-sputter-r5y","type":"blocks","created_at":"2026-02-06T07:26:54.288477-08:00","created_by":"Venkat Venkataraju"}]}
{"id":"homekit-matchstick-sputter-s30","title":"Display Mode Cycle","description":"Short press handler that cycles through display modes. Initial placeholder implementation, can be expanded later with actual mode definitions.","status":"open","priority":2,"issue_type":"task","owner":"venkat.venkataraju@gmail.com","created_at":"2026-01-31T20:18:08.600055-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-01-31T20:18:08.600055-08:00"}
{"id":"homekit-matchstick-sputter-stt","title":"HomeKit Identify Logic","description":"Implement HomeKit Identify service callback to flash all channels in a recognizable pattern when triggered. Use status LED (GPIO 22) and/or channel LEDs for visual feedback.","status":"open","priority":2,"issue_type":"feature","owner":"venkat.venkataraju@gmail.com","created_at":"2026-01-31T19:31:54.419528-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-01-31T19:31:54.419528-08:00"}
{"id":"homekit-matchstick-sputter-v7d","title":"Phase 2: Extract MarkovBaseLayer from Runner and Rain","description":"Create intermediate class that holds shared base-layer logic between RunnerAnimationBase and RainAnimationBase.\n\n## 2a: Create src/animation/markov_base_layer.h\n\nNew abstract class inheriting from AnimationBase:\n\n```cpp\n#pragma once\n#include \"animation_base.h\"\n\nclass MarkovBaseLayer : public AnimationBase {\npublic:\n    static constexpr uint8_t MARKOV_BASE_BRIGHTNESS = 40;\n    static constexpr uint8_t MARKOV_MAX_BRIGHTNESS = 220;\n\nprotected:\n    // Per-LED base state (4 channels × MAX_LEDS)\n    int8_t hueOffset[4][MAX_LEDS];\n    int8_t hueDir[4][MAX_LEDS];\n    uint8_t baseBrightness[4][MAX_LEDS];\n    int8_t brightDir[4][MAX_LEDS];\n\n    // Pure virtual: derived classes define harmony\n    virtual const int* getHarmonyOffsets() const = 0;\n    virtual int getNumHarmonyHues() const = 0;\n\n    void resetBaseLayer();      // Initialize state arrays\n    void updateBaseLayer();     // Markov random walk (~47 lines)\n    CRGB computeBaseColor(uint8_t ch, int led);  // Compute base LED color\n    virtual void pickHarmonyColor(int ch, uint8_t\u0026 h, uint8_t\u0026 s, uint8_t\u0026 v);\n};\n```\n\n## 2b: Refactor RunnerAnimationBase\n\n- Change inheritance: class RunnerAnimationBase : public MarkovBaseLayer\n- Remove: hueOffset, hueDir, baseBrightness, brightDir arrays (inherited)\n- Remove: updateBaseLayer() (inherited)\n- Rename pickRunnerColor() to use pickHarmonyColor() or make thin wrapper\n- Update reset() to call resetBaseLayer() then init runner-specific state\n- KEEP: Runner struct, runners[], gaussianLUT, updateRunners(), renderChannel()\n- KEEP: RUNNER_LENGTH, GAUSSIAN_VARIANCE, MIN/MAX_RUNNERS, MAX_RUNNER_SLOTS\n\n## 2c: Refactor RainAnimationBase\n\n- Change inheritance: class RainAnimationBase : public MarkovBaseLayer\n- Same removals as runner\n- Rename pickRaindropColor() to use pickHarmonyColor()\n- KEEP: Raindrop struct, raindrops[], updateRaindrops(), renderChannel()\n- KEEP: RAINDROP_LENGTH, RAINDROP_MAX_FRAMES, MIN/MAX_RAINDROPS, etc.\n\n## Memory Impact\n- No new allocations - arrays move up hierarchy but total count unchanged\n- One extra vtable pointer (4 bytes) per class - negligible\n\n## Verification\n- make build must succeed\n- Test all 10 runner/rain variants on hardware\n- Visual output must be identical to before refactoring","status":"open","priority":1,"issue_type":"task","owner":"venkat.venkataraju@gmail.com","created_at":"2026-02-06T07:25:55.251134-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-02-06T07:25:55.251134-08:00","dependencies":[{"issue_id":"homekit-matchstick-sputter-v7d","depends_on_id":"homekit-matchstick-sputter-d6u","type":"blocks","created_at":"2026-02-06T07:26:49.751428-08:00","created_by":"Venkat Venkataraju"},{"issue_id":"homekit-matchstick-sputter-v7d","depends_on_id":"homekit-matchstick-sputter-lm7","type":"blocks","created_at":"2026-02-06T07:26:54.039158-08:00","created_by":"Venkat Venkataraju"}]}
{"id":"homekit-matchstick-sputter-vn0","title":"Power cycle does not restore brightness to DEFAULT when NVS contains 0","description":"Brightness=0 in NVS should be corrected to MIN_BRIGHTNESS (80%) on boot. This was previously working but has regressed. Affects all animations (solid, fire, twinkle, harmony). Current fix attempts in led_channel.h are not working.","status":"closed","priority":1,"issue_type":"bug","owner":"venkat.venkataraju@gmail.com","created_at":"2026-02-02T21:26:24.226369-08:00","created_by":"Venkat Venkataraju","updated_at":"2026-02-04T08:43:34.983646-08:00","closed_at":"2026-02-04T08:43:34.983646-08:00","close_reason":"Closed"}
